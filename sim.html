<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Simulation - Documentation for Forester</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Intro</a></li><li class="chapter-item expanded "><a href="components.html"><strong aria-hidden="true">2.</strong> Components</a></li><li class="chapter-item expanded "><a href="api.html"><strong aria-hidden="true">3.</strong> Setup</a></li><li class="chapter-item expanded "><a href="intro_lang.html"><strong aria-hidden="true">4.</strong> Tree language</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="syntax.html"><strong aria-hidden="true">4.1.</strong> Syntax</a></li><li class="chapter-item expanded "><a href="imports.html"><strong aria-hidden="true">4.2.</strong> Imports</a></li><li class="chapter-item expanded "><a href="definitions.html"><strong aria-hidden="true">4.3.</strong> Definitions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="flow.html"><strong aria-hidden="true">4.3.1.</strong> Flow</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="seq.html"><strong aria-hidden="true">4.3.1.1.</strong> Sequences</a></li><li class="chapter-item expanded "><a href="falls.html"><strong aria-hidden="true">4.3.1.2.</strong> Fallbacks</a></li><li class="chapter-item expanded "><a href="par.html"><strong aria-hidden="true">4.3.1.3.</strong> Parallel</a></li></ol></li><li class="chapter-item expanded "><a href="decorators.html"><strong aria-hidden="true">4.3.2.</strong> Decorators</a></li><li class="chapter-item expanded "><a href="actions.html"><strong aria-hidden="true">4.3.3.</strong> Actions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="builtin.html"><strong aria-hidden="true">4.3.3.1.</strong> Built-In</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="invoc_intro.html"><strong aria-hidden="true">4.4.</strong> Invocations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="hot.html"><strong aria-hidden="true">4.4.1.</strong> Higher order tree</a></li><li class="chapter-item expanded "><a href="lambda.html"><strong aria-hidden="true">4.4.2.</strong> Lambda</a></li></ol></li><li class="chapter-item expanded "><a href="params.html"><strong aria-hidden="true">4.5.</strong> Parameters</a></li><li class="chapter-item expanded "><a href="antlr.html"><strong aria-hidden="true">4.6.</strong> Antlr grammar</a></li></ol></li><li class="chapter-item expanded "><a href="engine_intro.html"><strong aria-hidden="true">5.</strong> Runtime engine</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="engine.html"><strong aria-hidden="true">5.1.</strong> Engine</a></li><li class="chapter-item expanded "><a href="rt_args.html"><strong aria-hidden="true">5.2.</strong> Runtime arguments</a></li><li class="chapter-item expanded "><a href="bb.html"><strong aria-hidden="true">5.3.</strong> Blackboard</a></li><li class="chapter-item expanded "><a href="r_actions.html"><strong aria-hidden="true">5.4.</strong> Actions</a></li><li class="chapter-item expanded "><a href="trimming.html"><strong aria-hidden="true">5.5.</strong> Trimming</a></li><li class="chapter-item expanded "><a href="daemons.html"><strong aria-hidden="true">5.6.</strong> Daemons</a></li></ol></li><li class="chapter-item expanded "><a href="analysis.html"><strong aria-hidden="true">6.</strong> Analysis</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="viz.html"><strong aria-hidden="true">6.1.</strong> Visualization</a></li><li class="chapter-item expanded "><a href="trace.html"><strong aria-hidden="true">6.2.</strong> Tracing</a></li><li class="chapter-item expanded "><a href="sim.html" class="active"><strong aria-hidden="true">6.3.</strong> Simulation</a></li><li class="chapter-item expanded "><a href="ros_nav2.html"><strong aria-hidden="true">6.4.</strong> Export to ROS Nav2</a></li></ol></li><li class="chapter-item expanded "><a href="f_examples.html"><strong aria-hidden="true">7.</strong> Examples</a></li><li class="chapter-item expanded "><a href="tools.html"><strong aria-hidden="true">8.</strong> Tools</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="intellij.html"><strong aria-hidden="true">8.1.</strong> Intellij plugin</a></li><li class="chapter-item expanded "><a href="rem_action.html"><strong aria-hidden="true">8.2.</strong> Remote Action</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="rem_action_rs.html"><strong aria-hidden="true">8.2.1.</strong> Rust library for Remote Action</a></li><li class="chapter-item expanded "><a href="rem_action_py.html"><strong aria-hidden="true">8.2.2.</strong> Python library for Remote Action</a></li></ol></li><li class="chapter-item expanded "><a href="console.html"><strong aria-hidden="true">8.3.</strong> Console</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Documentation for Forester</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="simulation"><a class="header" href="#simulation">Simulation</a></h1>
<p>Forester provides a conception to execute the given tree, replacing the actions to stubs.
The major intention is to test the tree behavior and test all branches under the specific conditions
without coding the implementations at all.
The profile enables to mix in the specific state of blackboard, trace the changes and visualize the tree.</p>
<h2 id="preparations"><a class="header" href="#preparations">Preparations</a></h2>
<h3 id="configuration-profile"><a class="header" href="#configuration-profile">Configuration profile</a></h3>
<p><strong>All paths in the configuration files can be either absolute or relative to the root folder</strong></p>
<p>The file contains the settings information alongside with the information about stubbed options.</p>
<p>Below, the example of the file:</p>
<pre><code class="language-yaml">config:
  tracer: 
    file: gen/main.trace
    dt_fmt: "%d %H:%M:%S%.3f"
  graph: gen/main.svg
  bb:
    dump: gen/bb.json
  max_ticks: 10

actions:
  -
    name: task
    stub: failure
    params:
      delay: 100
</code></pre>
<p>Config section:</p>
<div class="table-wrapper"><table><thead><tr><th>Setting</th><th>Description</th><th>Default</th><th>Example</th></tr></thead><tbody>
<tr><td>tracer.file</td><td>the tracer settings to write to a file</td><td>if it is absent, there will be no action</td><td>gen/main.trace</td></tr>
<tr><td>tracer.dt_fmt</td><td>the tracer settings to given data format</td><td>if it is absent, there will be no action</td><td>"%d %H:%M:%S%.3f"</td></tr>
<tr><td>graph</td><td>the visualization file</td><td>if it is absent, there will be no action</td><td>gen/main.svg</td></tr>
<tr><td>bb.dump</td><td>the dump of the bb at the end</td><td>if it is absent, there will be no action</td><td>gen/bb.json</td></tr>
<tr><td>bb.load</td><td>the dump that will be used to init bb before sim</td><td>if it is absent, there will be no action</td><td>gen/init_bb.json</td></tr>
<tr><td>max_ticks</td><td>the maximum amount of ticks to work.</td><td>0 by default</td><td>10</td></tr>
<tr><td>http.port</td><td>The port for http server to communicate with the remote actions .</td><td>if it is absent, there will be no action</td><td>8080</td></tr>
</tbody></table>
</div>
<p>Actions sections:</p>
<p>The actions sections is an array to stub the actions</p>
<div class="table-wrapper"><table><thead><tr><th>Setting</th><th>Description</th><th>Default</th><th>Example</th></tr></thead><tbody>
<tr><td>name</td><td>the name of the stubbed action</td><td>should be presented</td><td>name</td></tr>
<tr><td>stub</td><td>the stubbed implementation</td><td>should be presented</td><td>success</td></tr>
<tr><td>params.delay</td><td>denotes the pause before start in millis</td><td>0</td><td>100</td></tr>
<tr><td>params.url</td><td>(For remote stub) the url to connect</td><td>should be presented</td><td>http://localhost:10000/action</td></tr>
<tr><td>params.server</td><td>(For remote stub) the url to provide to action to connect to bb</td><td>http://localhost</td><td>http://localhost:8080</td></tr>
</tbody></table>
</div>
<h4 id="default-profile"><a class="header" href="#default-profile">Default profile</a></h4>
<p>The simulation can be performed without giving the specific profile.
In that case, all actions that need to implement will be replaced with the success stub.
Other artifacts will not be generated.</p>
<h3 id="stubs"><a class="header" href="#stubs">Stubs</a></h3>
<ul>
<li>success: returns a success</li>
<li>failure: returns a failure</li>
<li>random: returns either a failure or a success randomly</li>
<li>remote: connects to the remote server and returns the result of the action. The details can be found in the <a href="./r_actions.html#remote-actions">Remote action</a>.</li>
</ul>
<p>The stubs success, failure, random have the following param:</p>
<ul>
<li>delay: in millis, the time to delay the stub.</li>
</ul>
<p>The remote stub has the following params:</p>
<ul>
<li>url: the url to connect to the remote server</li>
<li>server: the url to provide to the remote server to connect to the blackboard</li>
</ul>
<h2 id="process"><a class="header" href="#process">Process</a></h2>
<p>The simulation can be performed in on of two ways:</p>
<ul>
<li>using console application from console</li>
<li>using a library from rust code</li>
</ul>
<h3 id="in-the-code"><a class="header" href="#in-the-code">In the code</a></h3>
<p>Just use the builder and the simulator from the <code>simulator</code> module. For details,
please see the doc for <code>ForesterBuilder</code> and <code>SimulatorBuilder</code></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn smoke() {
     let mut sb = SimulatorBuilder::new();

     let root = PathBuf::from("simulator/smoke");

     sb.root(root.clone());
     sb.profile(PathBuf::from("sim.yaml"));
     
     let mut fb = ForesterBuilder::from_file_system();

     fb.main_file("main.tree".to_string());
     fb.root(root);

     sb.forester_builder(fb);
     
     let mut sim = sb.build().unwrap();
     sim.run().unwrap();
 }

 fn smoke_from_text() {
     let mut sb = SimulatorBuilder::new();

     let sim = PathBuf::from("simulator/smoke/sim.yaml");
     let mut fb = ForesterBuilder::from_text();
     sb.profile(sim);
     
     fb.text(
         r#"
 import "std::actions"

 root main sequence {
     store("info1", "initial")
     retryer(task(config = obj), success())
     store("info2","finish")
 }

 fallback retryer(t:tree, default:tree){
     retry(5) t(..)
     fail("just should fail")
     default(..)
 }

 impl task(config: object);
     "#
         .to_string(),
     );    
     sb.forester_builder(fb);
     let mut sim = sb.build().unwrap();
     sim.run().unwrap();
 }

<span class="boring">}</span></code></pre></pre>
<h3 id="in-the-console"><a class="header" href="#in-the-console">In the console</a></h3>
<p>Just use a <code>f-tree</code> console cli to run a simulation</p>
<pre><code class="language-shell">f-tree sim --root tree\tests\simulator\smoke\  --profile sim.yaml
</code></pre>
<ul>
<li>root can be omitted, the <code>&lt;pwd&gt;</code> folder will be taken by default</li>
<li>tree can be omitted if only one root definition in the file</li>
<li>main can be omitted, by default, the name <code>main.tree</code> will be taken.</li>
<li>profile can be omitted, the default profile will be taken.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="trace.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="ros_nav2.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="trace.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="ros_nav2.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid-init.js"></script>
        <script src="mermaid.min.js"></script>


    </div>
    </body>
</html>
