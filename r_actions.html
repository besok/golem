<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Actions - Documentation for Forester</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Intro</a></li><li class="chapter-item expanded "><a href="components.html"><strong aria-hidden="true">2.</strong> Components</a></li><li class="chapter-item expanded "><a href="api.html"><strong aria-hidden="true">3.</strong> Setup</a></li><li class="chapter-item expanded "><a href="intro_lang.html"><strong aria-hidden="true">4.</strong> Tree language</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="syntax.html"><strong aria-hidden="true">4.1.</strong> Syntax</a></li><li class="chapter-item expanded "><a href="imports.html"><strong aria-hidden="true">4.2.</strong> Imports</a></li><li class="chapter-item expanded "><a href="definitions.html"><strong aria-hidden="true">4.3.</strong> Definitions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="flow.html"><strong aria-hidden="true">4.3.1.</strong> Flow</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="seq.html"><strong aria-hidden="true">4.3.1.1.</strong> Sequences</a></li><li class="chapter-item expanded "><a href="falls.html"><strong aria-hidden="true">4.3.1.2.</strong> Fallbacks</a></li><li class="chapter-item expanded "><a href="par.html"><strong aria-hidden="true">4.3.1.3.</strong> Parallel</a></li></ol></li><li class="chapter-item expanded "><a href="decorators.html"><strong aria-hidden="true">4.3.2.</strong> Decorators</a></li><li class="chapter-item expanded "><a href="actions.html"><strong aria-hidden="true">4.3.3.</strong> Actions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="builtin.html"><strong aria-hidden="true">4.3.3.1.</strong> Built-In</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="invoc_intro.html"><strong aria-hidden="true">4.4.</strong> Invocations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="hot.html"><strong aria-hidden="true">4.4.1.</strong> Higher order tree</a></li><li class="chapter-item expanded "><a href="lambda.html"><strong aria-hidden="true">4.4.2.</strong> Lambda</a></li></ol></li><li class="chapter-item expanded "><a href="params.html"><strong aria-hidden="true">4.5.</strong> Parameters</a></li><li class="chapter-item expanded "><a href="antlr.html"><strong aria-hidden="true">4.6.</strong> Antlr grammar</a></li></ol></li><li class="chapter-item expanded "><a href="engine_intro.html"><strong aria-hidden="true">5.</strong> Runtime engine</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="engine.html"><strong aria-hidden="true">5.1.</strong> Engine</a></li><li class="chapter-item expanded "><a href="rt_args.html"><strong aria-hidden="true">5.2.</strong> Runtime arguments</a></li><li class="chapter-item expanded "><a href="bb.html"><strong aria-hidden="true">5.3.</strong> Blackboard</a></li><li class="chapter-item expanded "><a href="r_actions.html" class="active"><strong aria-hidden="true">5.4.</strong> Actions</a></li><li class="chapter-item expanded "><a href="trimming.html"><strong aria-hidden="true">5.5.</strong> Trimming</a></li><li class="chapter-item expanded "><a href="daemons.html"><strong aria-hidden="true">5.6.</strong> Daemons</a></li></ol></li><li class="chapter-item expanded "><a href="analysis.html"><strong aria-hidden="true">6.</strong> Analysis</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="viz.html"><strong aria-hidden="true">6.1.</strong> Visualization</a></li><li class="chapter-item expanded "><a href="trace.html"><strong aria-hidden="true">6.2.</strong> Tracing</a></li><li class="chapter-item expanded "><a href="sim.html"><strong aria-hidden="true">6.3.</strong> Simulation</a></li><li class="chapter-item expanded "><a href="ros_nav2.html"><strong aria-hidden="true">6.4.</strong> Export to ROS Nav2</a></li></ol></li><li class="chapter-item expanded "><a href="f_examples.html"><strong aria-hidden="true">7.</strong> Examples</a></li><li class="chapter-item expanded "><a href="tools.html"><strong aria-hidden="true">8.</strong> Tools</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="intellij.html"><strong aria-hidden="true">8.1.</strong> Intellij plugin</a></li><li class="chapter-item expanded "><a href="rem_action.html"><strong aria-hidden="true">8.2.</strong> Remote Action</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="rem_action_rs.html"><strong aria-hidden="true">8.2.1.</strong> Rust library for Remote Action</a></li><li class="chapter-item expanded "><a href="rem_action_py.html"><strong aria-hidden="true">8.2.2.</strong> Python library for Remote Action</a></li></ol></li><li class="chapter-item expanded "><a href="console.html"><strong aria-hidden="true">8.3.</strong> Console</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Documentation for Forester</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="actions"><a class="header" href="#actions">Actions</a></h1>
<p>Actions are the leaves of the tree. They require some implementation to be executed.</p>
<h2 id="action-types"><a class="header" href="#action-types">Action types</a></h2>
<p>There are three types of actions available at that moment:</p>
<ul>
<li>
<p>Sync actions: the actions that block the flow until the action get done.</p>
</li>
<li>
<p>Async action: initiate the calculation at the different thread and return <code>running</code> immediately.</p>
</li>
<li>
<p>Remote action: send the blocking request (http) to the remote host.</p>
</li>
<li>
<p>For heavy actions, preferably to use <code>async actions</code>.</p>
</li>
</ul>
<h2 id="traits"><a class="header" href="#traits">Traits</a></h2>
<p>The action trait implements two functions, <code>tick()</code> and <code>halt()</code>.</p>
<p>The <code>tick()</code> function is the main entry point of the action and will be called whenever the node is executed.</p>
<p>The <code>halt()</code> function is used to notify a <code>running</code> action that a reactive flow node (e.g. <code>r_sequnce</code>) has changed the control flow. This means the previously <code>running</code> action won't be called again, or won't be called for a while, and so should gracefully clean up. The <code>halt()</code> function has a default no-op implementation that can be used if no clean up is necessary.</p>
<p>Actions must halt as quickly as possible, and the call to <code>halt()</code> should not block the execution.</p>
<h3 id="impl-for-sync-actions"><a class="header" href="#impl-for-sync-actions"><code>Impl</code> for sync actions</a></h3>
<p>Sync actions are the only actions that currently implement the <code>halt()</code> function.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub trait Impl {
    fn tick(&amp;self, args: RtArgs, ctx: TreeContextRef) -&gt; Tick;

    fn halt(&amp;self, args: RtArgs, ctx: TreeContextRef) -&gt; RtOk {
        // Default halt is a no-op function.
        let _ = args;
        let _ = ctx;
        Ok(())
    }
}

<span class="boring">}</span></code></pre></pre>
<h3 id="implasync-for-async-actions"><a class="header" href="#implasync-for-async-actions"><code>ImplAsync</code> for async actions</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub trait ImplAsync: Sync + Send {
    fn tick(&amp;self, args: RtArgs, ctx: TreeContextRef) -&gt; Tick;
}
<span class="boring">}</span></code></pre></pre>
<p>Where <code>args</code> are the given arguments from the tree definition and invocation and <code>ctx</code>
is a reference of the invocation context with <code>bb</code> and <code>tracer</code>.</p>
<h2 id="mutability"><a class="header" href="#mutability">Mutability</a></h2>
<p>The actions are intentionally stateless thus they can't mutate.
Therefore, it is better off to use blackboard to keep some data between the calls.</p>
<h2 id="how-to-register-action"><a class="header" href="#how-to-register-action">How to register action</a></h2>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn simple_delay() {
    let mut forester_builder = fb("decorators/simple_delay");

    forester_builder.register_sync_action("store", StoreData);

}
<span class="boring">}</span></code></pre></pre>
<h2 id="async-actions"><a class="header" href="#async-actions">Async actions</a></h2>
<p>The async actions are executed in the multithreading environment and return the <code>running</code> tick result instantly.
It does not block the execution of the tree and can be used in parallel nodes, etc.</p>
<p>On the other hand, every time when the tree is reloaded, the tick number is increased that can exceed the limit on ticks
if the system has it. Therefore, it needs to take into account (when forester runs with the limit of ticks.)</p>
<h2 id="remote-actions"><a class="header" href="#remote-actions">Remote actions</a></h2>
<p>The remote actions are the actions that send the request to the remote host and wait for the response.
For now, it is only http requests with json body and json response.</p>
<p>The remote actions can have access to the blackboard and the tracer if the http-server is running (see <a href="./engine.html#http-server">http-server</a>).</p>
<p>The remote actions should implement <code>ImplRemote</code> trait:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span>
<span class="boring">fn main() {
</span>pub trait ImplRemote: Sync + Send {
    fn tick(&amp;self, args: RtArgs, ctx: TreeRemoteContextRef) -&gt; Tick;
}
<span class="boring">}</span></code></pre></pre>
<p>Where <code>args</code> are the given arguments from the tree definition and invocation and <code>ctx</code> has the information about the http_server:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct TreeRemoteContextRef&lt;'a&gt; {
    pub curr_ts: Timestamp, // current timestamp
    pub port: u16,          // port of the http server, to access the blackboard and tracer
    pub env: &amp;'a mut RtEnv, // runtime env to execute the http request
}
<span class="boring">}</span></code></pre></pre>
<p>The default implementation of the <code>tick</code> method is available in <code>forester_rs::runtime::action::builtin::remote::RemoteHttpAction</code>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct RemoteHttpAction {
    url: String,
    serv_ip: Option&lt;String&gt;,
}
<span class="boring">}</span></code></pre></pre>
<p>it accepts the url and the ip of the http server (if it is not localhost, which is a default parameter).</p>
<p>The message is the following:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct RemoteActionRequest {
    pub tick: usize,            // current tick
    pub args: Vec&lt;RtArgument&gt;,  // arguments from the tree
    pub serv_url: String,       // url of the http server to get access to the blackboard and tracer
}
<span class="boring">}</span></code></pre></pre>
<p>The response is the following a <code>TickResult</code>.</p>
<p>How to implement the client side, please see <a href="./rem_action.html">remote action lib</a>.</p>
<h2 id="default-actions"><a class="header" href="#default-actions">Default actions</a></h2>
<p>By default, there are several implementations for http and interactions with bb are available in</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use forester_rs::runtime::action::builtin::*;
<span class="boring">}</span></code></pre></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="bb.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="trimming.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="bb.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="trimming.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid-init.js"></script>
        <script src="mermaid.min.js"></script>


    </div>
    </body>
</html>
